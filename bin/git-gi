#! /bin/sh

#
# git-gi
#

set -e

data_dir="$(cd $(dirname $0)/../ && pwd)/share/git-gi/gitignore"

echo() { /bin/echo "$@"; }

usage_exit() {
    cat<<EOS
usage: git gi [list] :types: [...]

    git-gi commands are:
      list    - lists the operating systems, programming languages and IDE input types
      :types: - generates .gitignore files for types of operating systems, programming languages or IDEs

EOS
    exit 1
}


gi() {
    echo "### Generated by git-gi"
    echo
    for x in "$@";do
        filename=${data_dir}/${x}.gitignore
        if [ -e ${filename} ];then
            echo "### ${x}"
            cat ${filename}
            echo
            echo
        else
            echo "#!! ERROR: ${x} is undefined. Use list command to see defined gitignore types !!#"
        fi
    done
    echo
}

list() {
    support_list=$(for x in $(ls ${data_dir});do
        echo -n ${x} | perl -pe "s/(?:^([a-zA-z0-9\+-_]+).gitignore$)/\$1 /"
    done)
    echo ${support_list}
}

main() {
    [ $# -eq "0" ] && usage_exit
    case "$1" in
        list)
            list && exit 1;
            ;;
        -h)
            usage_exit
            ;;
        *)
            gi "$@"
            ;;
    esac
}


main "$@" && exit 0
